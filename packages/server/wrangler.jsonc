{
  // Zajel Bootstrap Server - Cloudflare Worker Configuration
  // Purpose: VPS server discovery and attestation authority
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "zajel-signaling",
  "main": "src/index.js",
  "compatibility_date": "2025-01-01",

  // Durable Objects for server registry and attestation
  "durable_objects": {
    "bindings": [
      {
        "name": "SERVER_REGISTRY",
        "class_name": "ServerRegistryDO"
      },
      {
        "name": "ATTESTATION_REGISTRY",
        "class_name": "AttestationRegistryDO"
      }
    ]
  },

  // Migrations for Durable Objects
  "migrations": [
    {
      "tag": "v1",
      "new_classes": ["SignalingRoom"]
    },
    {
      "tag": "v2",
      "new_classes": ["RelayRegistryDO"]
    },
    {
      "tag": "v3",
      "new_classes": ["ServerRegistryDO"],
      "deleted_classes": ["SignalingRoom", "RelayRegistryDO"]
    },
    {
      "tag": "v4",
      "new_classes": ["AttestationRegistryDO"]
    }
  ],

  // Custom domain for production
  "routes": [
    { "pattern": "signal.zajel.hamzalabs.dev", "custom_domain": true }
  ],

  // Development settings
  "dev": {
    "port": 8080,
    "local_protocol": "http"
  },

  // QA Environment for PR testing
  "env": {
    "qa": {
      "name": "zajel-signaling-qa",
      "durable_objects": {
        "bindings": [
          {
            "name": "SERVER_REGISTRY",
            "class_name": "ServerRegistryDO"
          },
          {
            "name": "ATTESTATION_REGISTRY",
            "class_name": "AttestationRegistryDO"
          }
        ]
      },
      "routes": [
        { "pattern": "signal.zajel.qa.hamzalabs.dev", "custom_domain": true }
      ]
    }
  }
}
